---
title: "LGN_Bee_data_Analysis_2"
author: "Liliana_Lay"
date: "2025-07-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r}
#Reading in both data sets
library(tidyverse)
bee_data <- read_csv("~/Downloads/6-18-25 Lagoon Ground Nesters Data Sheet 3 - R Bee data.csv", skip = 1, 
                     col_names = c("Date", "Bee_color", "Nest_Number", "Time_Entered", "Time_Exited"))

temp_data <- read_csv("~/Downloads/6-18-25 Lagoon Ground Nesters Data Sheet 3 - R environmental Data.csv", skip = 1, col_names = c("Date", "Time", "Temperature F") )

```


```{r}
#Dr. Seltmanns Github cleaning code that works to reformat the time data so R reads it as time on the 12 hour clock and figure out the duration in minutes the bees spend in the nests.
####################################
#bee data filtering and reformatting
# Parse Date column using lubridate::mdy()
bee_data <- bee_data %>%
  mutate(Date = mdy(Date))

# View result
bee_data %>% select(Date) %>% distinct()

# Define a helper function to add AM/PM
fix_ampm <- function(time_str) {
  time_str <- str_trim(time_str)
  if (is.na(time_str) || time_str == "") return(NA_character_)
  
  hour_val <- suppressWarnings(as.numeric(str_extract(time_str, "^[0-9]{1,2}")))
  if (is.na(hour_val)) return(NA_character_)
  
  if (hour_val >= 8 & hour_val <= 11) {
    return(paste0(time_str, " AM"))
  } else {
    return(paste0(time_str, " PM"))
  }
}

# Apply it to both time columns
bee_data <- bee_data %>%
  mutate(
    Time_Entered_fixed = sapply(Time_Entered, fix_ampm),
    Time_Exited_fixed  = sapply(Time_Exited, fix_ampm)
  )
##
# View result
bee_data %>% select(Date, Bee_color, Nest_Number, Time_Entered_fixed, Time_Exited_fixed)

#remove rows with NA and create dt for those witohout NA (will want to return them for determining how many nests a female enteres)
bee_data <- bee_data %>%
  filter(!is.na(Time_Entered_fixed) & !is.na(Time_Exited_fixed)) %>%
  mutate(
    Time_Entered_dt = parse_date_time(paste(Date, Time_Entered_fixed), orders = "ymd HM p"),
    Time_Exited_dt  = parse_date_time(paste(Date, Time_Exited_fixed), orders = "ymd HM p")
  )

bee_data <- bee_data %>%
  mutate(
    Duration_minutes = as.numeric(difftime(Time_Exited_dt, Time_Entered_dt, units = "mins"))
  )

# View result
bee_data %>%
  select(Date, Time_Entered_fixed, Time_Entered_dt, Time_Exited_fixed, Time_Exited_dt, Duration_minutes)

```


```{r}
####################################
# Code to reformat time data on temp_data based on Dr. Seltmanns code 

# Parse Date column using lubridate::mdy()
temp_data <- temp_data %>%
  mutate(Date = mdy(Date))

# View result
temp_data %>% select(Date) %>% distinct()

# Define a helper function to add AM/PM
# Move into cleaning script
fix_ampm <- function(time_str) {
  time_str <- str_trim(time_str)
  if (is.na(time_str) || time_str == "") return(NA_character_)
  
  hour_val <- suppressWarnings(as.numeric(str_extract(time_str, "^[0-9]{1,2}")))
  if (is.na(hour_val)) return(NA_character_)
  
  if (hour_val >= 8 & hour_val <= 11) {
    return(paste0(time_str, " AM"))
  } else {
    return(paste0(time_str, " PM"))
  }
}

#more into cleaning script
# Apply it to the time column
temp_data <- temp_data %>%
  mutate(
    Time_fixed = sapply(Time, fix_ampm))


```


```{r}
# add creation of date/time column in temp dataset
```


```{r}

```

